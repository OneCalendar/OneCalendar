/*
 * Copyright 2012 OneCalendar
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

package api.eventbrite

import org.scalatest.matchers.ShouldMatchers
import org.scalatest.FunSuite
import org.scalatest.BeforeAndAfter
import java.net.URL
import com.codahale.jerkson.Json
import java.io.{InputStreamReader, BufferedReader}
import org.codehaus.jackson.annotate.JsonIgnoreProperties
import java.lang.IllegalArgumentException

class EventbriteTest extends FunSuite with ShouldMatchers with BeforeAndAfter with Json {
    import Eventbrite.JsonResponse

    val json: JsonResponse = Eventbrite.request("scala")

    test("should have something from eventbrite") {
        json.length should be > 1
    }

    test("should map 1 dummy event") {
        val events: Seq[Event] = Eventbrite.parse("""{"events":[ {"event": { "id":4737033595 } } ] }""")
        events.size should be (1)
    }

    test("should map all event fields") {
        val json = """{
             "event":{
                 "id":4819205373,
                 "title":"Typesafe's Fast Track to Scala",
                 "start_date":"2013-01-28 09:00:00",
                 "end_date":"2013-01-29 17:00:00",
                 "description":"<P><SPAN STYLE=\"font-family: tahoma, arial, helvetica, sans-serif; color: #003366; font-size: x-large;\">Summary</SPAN></P>\r\n<P><SPAN STYLE=\"font-family: tahoma, arial, helvetica, sans-serif; color: #003366; font-size: medium;\"><A HREF=\"http://www.composables.com\" TARGET=\"_blank\">Composable Solutions</A>, in partnership with <A HREF=\"http://www.typesafe.com\" TARGET=\"_blank\">Typesafe</A>, is pleased to offer a two-day course, designed by Martin Odersky, the creator of the Scala programming language, and Heiko Seeberger, a recognized Scala expert, with a goal of giving you an excellent grounding in Scala.</SPAN></P>\r\n<P><SPAN STYLE=\"font-family: tahoma, arial, helvetica, sans-serif; color: #003366; font-size: medium;\">It is intended to enable developers or development managers, who are experienced programmers in Java or other production languages like C++, C# or Ruby, to confidently start programming in Scala. No previous knowledge of Scala is assumed. Although intense, the course ensures you will have a solid understanding of the fundamentals of the language, the tooling and the development process as well as a good appreciation of the more advanced features. If you already have Scala programming experience, then this course could be a useful refresher.</SPAN></P>\r\n<P><SPAN STYLE=\"font-family: tahoma, arial, helvetica, sans-serif; color: #003366; font-size: medium;\"><BR></SPAN></P>\r\n<P><SPAN STYLE=\"font-family: tahoma, arial, helvetica, sans-serif; color: #003366; font-size: x-large;\">Objectives</SPAN></P>\r\n<P><SPAN STYLE=\"font-family: tahoma, arial, helvetica, sans-serif; color: #003366; font-size: medium;\">After having participated in this course you should:</SPAN></P>\r\n<UL>\r\n<LI><SPAN STYLE=\"font-family: tahoma, arial, helvetica, sans-serif; color: #003366; font-size: medium;\">be a competent user of Scala constructs in application code</SPAN></LI>\r\n<LI><SPAN STYLE=\"font-family: tahoma, arial, helvetica, sans-serif; color: #003366; font-size: medium;\">know and be able to apply the functional programming style in Scala</SPAN></LI>\r\n<LI><SPAN STYLE=\"font-family: tahoma, arial, helvetica, sans-serif; color: #003366; font-size: medium;\">know how to use the fundamental Scala tools</SPAN></LI>\r\n<LI><SPAN STYLE=\"font-family: tahoma, arial, helvetica, sans-serif; color: #003366; font-size: medium;\">be confident to start using Scala in production applications</SPAN></LI>\r\n</UL>\r\n<P><SPAN STYLE=\"line-height: 21px; text-align: -webkit-auto; font-family: tahoma, arial, helvetica, sans-serif; color: #003366; font-size: medium;\"><SPAN STYLE=\"font-size: x-large;\"><BR></SPAN></SPAN></P>\r\n<P><SPAN STYLE=\"line-height: 21px; text-align: -webkit-auto; font-family: tahoma, arial, helvetica, sans-serif; color: #003366; font-size: medium;\"><SPAN STYLE=\"font-size: x-large;\">Prerequisites</SPAN>\u00a0</SPAN></P>\r\n<P><SPAN STYLE=\"line-height: 21px; text-align: -webkit-auto; font-family: tahoma, arial, helvetica, sans-serif; color: #003366; font-size: medium;\">The presentation will frequently be mixed with hands-on exercises that give you a good opportunity to try what you have learnt and a chance to clarify your understanding. The training facility can provide a certain number of workstations, but we highly recommend bringing your laptop so that you can preserve a fully set up Scala development environment after the course ends.</SPAN></P>\r\n<P><SPAN STYLE=\"line-height: 21px; text-align: -webkit-auto; font-family: tahoma, arial, helvetica, sans-serif; color: #003366; font-size: medium;\"><BR></SPAN></P>\r\n<P STYLE=\"text-align: -webkit-auto;\"><SPAN STYLE=\"font-size: x-large; color: #003366;\">Instructors</SPAN><SPAN STYLE=\"color: #003366; font-family: tahoma, arial, helvetica, sans-serif; line-height: 21px; font-size: medium;\">\u00a0</SPAN>\u00a0</P>\r\n<P><SPAN STYLE=\"line-height: 21px; text-align: -webkit-auto; font-family: tahoma, arial, helvetica, sans-serif; color: #003366; font-size: medium;\"><SPAN STYLE=\"line-height: 18px;\"><SPAN STYLE=\"font-size: large;\"><STRONG>Brian Clapper</STRONG></SPAN> has nearly 30 years' experience building and maintaining software systems and has been a consultant since 2009. Brian has a broad base of experience, from financial trading systems and master data management software to ecommerce web sites and Internet advertising software. He is comfortable working in companies of all sizes, but he has a special fondness for high-energy startups. He knows, and regularly uses, many different programming languages, including Scala, Python, Ruby, Java, C and C#. (He likes to think of himself as a generalist and a polyglot.) Brian is founder of the\u00a0</SPAN><SPAN STYLE=\"color: #ff6600;\"><A STYLE=\"color: #0088cc; font-family: 'Open Sans', Helvetica, Arial, sans-serif; font-size: 16px; line-height: 18px;\" HREF=\"http://scala-phase.org/\" TARGET=\"_blank\"><SPAN STYLE=\"color: #ff6600;\">Philadelphia Area Scala Enthusiasts</SPAN></A></SPAN><SPAN STYLE=\"line-height: 18px;\">\u00a0(PHASE). He is co-organizer of\u00a0</SPAN><SPAN STYLE=\"color: #ff6600;\"><A STYLE=\"color: #0088cc; font-family: 'Open Sans', Helvetica, Arial, sans-serif; font-size: 16px; line-height: 18px;\" HREF=\"http://scalathon.org/\" TARGET=\"_blank\"><SPAN STYLE=\"color: #ff6600;\">Scalathon</SPAN></A></SPAN><SPAN STYLE=\"line-height: 18px;\">, the international Scala hackathon, and he has been a co-organizer of the annual\u00a0</SPAN><SPAN STYLE=\"color: #ff6600;\"><A STYLE=\"color: #0088cc; font-family: 'Open Sans', Helvetica, Arial, sans-serif; font-size: 16px; line-height: 18px;\" HREF=\"http://nescala.org/\" TARGET=\"_blank\"><SPAN STYLE=\"color: #ff6600;\">Northeast Scala Symposium</SPAN></A></SPAN><SPAN STYLE=\"line-height: 18px;\">\u00a0since it began, in 2011. Brian maintains a number of open-source Scala projects, including\u00a0</SPAN><SPAN STYLE=\"color: #ff6600;\"><A STYLE=\"color: #0088cc; font-family: 'Open Sans', Helvetica, Arial, sans-serif; font-size: 16px; line-height: 18px;\" HREF=\"http://software.clapper.org/argot/\" TARGET=\"_blank\"><SPAN STYLE=\"color: #ff6600;\">Argot</SPAN></A></SPAN><SPAN STYLE=\"line-height: 18px;\">\u00a0(a command line parser),\u00a0</SPAN><SPAN STYLE=\"color: #ff6600;\"><A STYLE=\"color: #0088cc; font-family: 'Open Sans', Helvetica, Arial, sans-serif; font-size: 16px; line-height: 18px;\" HREF=\"http://software.clapper.org/avsl/\" TARGET=\"_blank\"><SPAN STYLE=\"color: #ff6600;\">AVSL</SPAN></A></SPAN><SPAN STYLE=\"line-height: 18px;\">\u00a0(an\u00a0</SPAN><SPAN STYLE=\"color: #ff6600;\"><A STYLE=\"color: #0088cc; font-family: 'Open Sans', Helvetica, Arial, sans-serif; font-size: 16px; line-height: 18px;\" HREF=\"http://www.slf4j.org/\" TARGET=\"_blank\"><SPAN STYLE=\"color: #ff6600;\">SLF4J</SPAN></A></SPAN><SPAN STYLE=\"line-height: 18px;\">-based logging framework),\u00a0</SPAN><SPAN STYLE=\"color: #ff6600;\"><A STYLE=\"color: #0088cc; font-family: 'Open Sans', Helvetica, Arial, sans-serif; font-size: 16px; line-height: 18px;\" HREF=\"http://software.clapper.org/grizzled-scala/\" TARGET=\"_blank\"><SPAN STYLE=\"color: #ff6600;\">Grizzled Scala</SPAN></A></SPAN><SPAN STYLE=\"line-height: 18px;\">\u00a0(a general purpose library),\u00a0</SPAN><SPAN STYLE=\"color: #ff6600;\"><A STYLE=\"color: #0088cc; font-family: 'Open Sans', Helvetica, Arial, sans-serif; font-size: 16px; line-height: 18px;\" HREF=\"http://software.clapper.org/classutil/\" TARGET=\"_blank\"><SPAN STYLE=\"color: #ff6600;\">ClassUtil</SPAN></A></SPAN><SPAN STYLE=\"line-height: 18px;\">\u00a0(a fast class-finder library),\u00a0</SPAN><SPAN STYLE=\"color: #ff6600;\"><A STYLE=\"color: #0088cc; font-family: 'Open Sans', Helvetica, Arial, sans-serif; font-size: 16px; line-height: 18px;\" HREF=\"http://software.clapper.org/sqlshell/\" TARGET=\"_blank\"><SPAN STYLE=\"color: #ff6600;\">SQLShell</SPAN></A></SPAN><SPAN STYLE=\"line-height: 18px;\">\u00a0(a JDBC-based SQL command shell), and several\u00a0</SPAN><A STYLE=\"color: #0088cc; font-family: 'Open Sans', Helvetica, Arial, sans-serif; font-size: 16px; line-height: 18px;\" HREF=\"http://www.scala-sbt.org/\" TARGET=\"_blank\"><SPAN STYLE=\"color: #003366;\">SBT</SPAN></A><SPAN STYLE=\"line-height: 18px;\">\u00a0plugins. All are available at\u00a0</SPAN><SPAN STYLE=\"color: #ff6600;\"><A STYLE=\"color: #0088cc; font-family: 'Open Sans', Helvetica, Arial, sans-serif; font-size: 16px; line-height: 18px;\" HREF=\"http://software.clapper.org/\" TARGET=\"_blank\"><SPAN STYLE=\"color: #ff6600;\">software.<SPAN CLASS=\"il\">clapper</SPAN>.org</SPAN></A></SPAN><SPAN STYLE=\"line-height: 18px;\">\u00a0or in Brian's\u00a0</SPAN><SPAN STYLE=\"color: #ff6600;\"><A STYLE=\"color: #0088cc; font-family: 'Open Sans', Helvetica, Arial, sans-serif; font-size: 16px; line-height: 18px;\" HREF=\"https://github.com/bmc/\" TARGET=\"_blank\"><SPAN STYLE=\"color: #ff6600;\">GitHub repository</SPAN></A></SPAN><SPAN STYLE=\"line-height: 18px;\">.</SPAN></SPAN></P>\r\n<P STYLE=\"text-align: -webkit-auto;\"><FONT SIZE=\"3\" COLOR=\"#003366\" FACE=\"tahoma, arial, helvetica, sans-serif\"><SPAN STYLE=\"line-height: 18px;\"><BR></SPAN></FONT></P>\r\n<P STYLE=\"color: #000000; font-family: Helvetica, Arial, sans-serif; font-size: 12px; line-height: normal; text-align: left;\"><SPAN STYLE=\"line-height: 21px; text-align: -webkit-auto; font-family: tahoma, arial, helvetica, sans-serif; color: #003366; font-size: medium;\"><SPAN STYLE=\"line-height: 18px;\"><SPAN STYLE=\"font-size: large;\"><STRONG>Nermin Serifovic</STRONG></SPAN> has 10 years of experience building enterprise software applications using Java technologies. For the past 5 years he has focused on architecting, designing and developing backend platforms. Nermin has been a Scala enthusiast since 2009 and practitioning it professionally since mid 2011. He has given various talks at JavaOne, <A HREF=\"http://days2011.scala-lang.org/node/138/293\" TARGET=\"_blank\">Scala Days</A> and <A HREF=\"http://vimeo.com/20290504\" TARGET=\"_blank\">Northeast Scala Symposium</A>, as well as at local Scala and Java user groups. Nermin is a founder and co-organizer of\u00a0</SPAN><SPAN STYLE=\"color: #ff6600;\"><A STYLE=\"color: #0088cc; font-family: 'Open Sans', Helvetica, Arial, sans-serif; font-size: 16px; line-height: 18px;\" HREF=\"http://www.meetup.com/boston-scala/\" TARGET=\"_blank\"><SPAN STYLE=\"color: #ff6600;\">Boston Area Scala Enthusiasts</SPAN></A></SPAN><SPAN STYLE=\"line-height: 18px;\">\u00a0user group and co-founder and co-organizer of\u00a0</SPAN><SPAN STYLE=\"color: #ff6600;\"><A STYLE=\"color: #0088cc; font-family: 'Open Sans', Helvetica, Arial, sans-serif; font-size: 16px; line-height: 18px;\" HREF=\"http://nescala.org/\" TARGET=\"_blank\"><SPAN STYLE=\"color: #ff6600;\">Northeast Scala Symposium</SPAN></A></SPAN><SPAN STYLE=\"line-height: 18px;\">. Furthermore, he is a co-creator and co-maintainer of the\u00a0</SPAN><SPAN STYLE=\"color: #ff6600;\"><A STYLE=\"color: #0088cc; font-family: 'Open Sans', Helvetica, Arial, sans-serif; font-size: 16px; line-height: 18px;\" HREF=\"http://www.scalapuzzlers.com/\" TARGET=\"_blank\"><SPAN STYLE=\"color: #ff6600;\">Scala Puzzlers website</SPAN></A></SPAN><SPAN STYLE=\"line-height: 18px;\">. Nermin holds a MEng in Computer Science from Cornell University and his areas of interest include distributed systems along with concurrent, parallel and functional programming.</SPAN></SPAN></P>\r\n<P><SPAN STYLE=\"font-family: tahoma, arial, helvetica, sans-serif; color: #003366; font-size: medium;\">\u00a0</SPAN></P>\r\n<P><SPAN STYLE=\"font-family: tahoma, arial, helvetica, sans-serif; color: #003366; font-size: x-large;\">Outline</SPAN></P>\r\n<P><STRONG><SPAN STYLE=\"font-family: tahoma, arial, helvetica, sans-serif; color: #003366; font-size: medium;\">Introduction</SPAN></STRONG></P>\r\n<P><STRONG><SPAN STYLE=\"font-family: tahoma, arial, helvetica, sans-serif; color: #003366; font-size: medium;\">First steps in Scala</SPAN></STRONG></P>\r\n<P><STRONG><SPAN STYLE=\"font-family: tahoma, arial, helvetica, sans-serif; color: #003366; font-size: medium;\">OO basics</SPAN></STRONG></P>\r\n<P><STRONG><SPAN STYLE=\"font-family: tahoma, arial, helvetica, sans-serif; color: #003366; font-size: medium;\">Testing</SPAN></STRONG></P>\r\n<P><FONT SIZE=\"3\" COLOR=\"#003366\" FACE=\"tahoma, arial, helvetica, sans-serif\"><STRONG>Collections and functional programming</STRONG></FONT></P>\r\n<P><STRONG><SPAN STYLE=\"font-family: tahoma, arial, helvetica, sans-serif; color: #003366; font-size: medium;\">For-expressions and loops</SPAN></STRONG></P>\r\n<P><SPAN STYLE=\"font-family: tahoma, arial, helvetica, sans-serif; color: #003366; font-size: medium;\"><STRONG>Inheritance and traits</STRONG>\u00a0</SPAN></P>\r\n<P><SPAN STYLE=\"font-family: tahoma, arial, helvetica, sans-serif; color: #003366; font-size: medium;\"><STRONG>Pattern Matching</STRONG>\u00a0</SPAN></P>\r\n<P><SPAN STYLE=\"font-family: tahoma, arial, helvetica, sans-serif; color: #003366; font-size: medium;\"><STRONG>Dealing with optional values</STRONG>\u00a0</SPAN></P>\r\n<DIV>\r\n<DIV><SPAN STYLE=\"font-family: tahoma, arial, helvetica, sans-serif; font-size: small;\"><FONT SIZE=\"3\" COLOR=\"#000080\" FACE=\"tahoma, arial, helvetica, sans-serif\"><SPAN STYLE=\"line-height: 20px;\"><BR></SPAN></FONT></SPAN></DIV>\r\n<DIV><SPAN STYLE=\"font-family: tahoma, arial, helvetica, sans-serif; font-size: small; color: #000080;\"><FONT SIZE=\"3\" COLOR=\"#000080\" FACE=\"tahoma, arial, helvetica, sans-serif\"><SPAN STYLE=\"line-height: 20px;\">Cancellation Policy</SPAN></FONT></SPAN></DIV>\r\n<DIV><SPAN STYLE=\"font-family: tahoma, arial, helvetica, sans-serif; font-size: small; color: #000080;\"><FONT SIZE=\"3\" COLOR=\"#000080\" FACE=\"tahoma, arial, helvetica, sans-serif\"><SPAN STYLE=\"line-height: 20px;\"><BR></SPAN></FONT></SPAN></DIV>\r\n<DIV><SPAN STYLE=\"font-family: tahoma, arial, helvetica, sans-serif; font-size: small; color: #000080;\"><FONT SIZE=\"3\" COLOR=\"#000080\" FACE=\"tahoma, arial, helvetica, sans-serif\"><SPAN STYLE=\"line-height: 20px;\">This course is offered contigent upon minimum enrollment requirements. Composable Solutions reserves the right to cancel the course in case of a low enrollment, not later than three weeks before beginning of the course. You will receive a full refund if the course is cancelled.</SPAN></FONT></SPAN></DIV>\r\n<DIV><SPAN STYLE=\"font-family: tahoma, arial, helvetica, sans-serif; font-size: small; color: #000080;\"><FONT SIZE=\"3\" COLOR=\"#000080\" FACE=\"tahoma, arial, helvetica, sans-serif\"><SPAN STYLE=\"line-height: 20px;\"><BR></SPAN></FONT></SPAN></DIV>\r\n<DIV><SPAN STYLE=\"font-family: tahoma, arial, helvetica, sans-serif; font-size: small; color: #000080;\"><FONT SIZE=\"3\" COLOR=\"#000080\" FACE=\"tahoma, arial, helvetica, sans-serif\"><SPAN STYLE=\"line-height: 20px;\">Students who need to cancel the attendance will receive (less any registration servicing fees):</SPAN></FONT></SPAN></DIV>\r\n<DIV>\r\n<UL>\r\n<LI><SPAN STYLE=\"color: #000080;\"><FONT SIZE=\"3\" COLOR=\"#000080\" FACE=\"tahoma, arial, helvetica, sans-serif\"><SPAN STYLE=\"line-height: 20px;\">Full refund with two weeks notice</SPAN></FONT></SPAN></LI>\r\n<LI><SPAN STYLE=\"color: #000080;\"><FONT SIZE=\"3\" COLOR=\"#000080\" FACE=\"tahoma, arial, helvetica, sans-serif\"><SPAN STYLE=\"line-height: 20px;\">80% refund with one week notice</SPAN></FONT></SPAN></LI>\r\n<LI><SPAN STYLE=\"color: #000080;\"><FONT SIZE=\"3\" COLOR=\"#000080\" FACE=\"tahoma, arial, helvetica, sans-serif\"><SPAN STYLE=\"line-height: 20px;\">25% refund with less than one week notice</SPAN></FONT></SPAN></LI>\r\n</UL>\r\n</DIV>\r\n</DIV>",
                 "tags":"Scala training",
                 "url":"http://www.eventbrite.com/event/4819205373/SRCH",
                 "timezone_offset":"GMT-0500",
                 "venue":{
                    "city":"Boston",
                    "country":"United States",
                    "region":"MA",
                    "postal_code":"75000",
                    "address_2":"line 2 of address",
                    "address":"line 1 of address"
                 }
             }
        }"""
        val event: Event = Eventbrite.parse[EventOrSummary](json).event.get
        event.id.get should be ("4819205373")
        event.title.get should be ("Typesafe's Fast Track to Scala")
        event.start_date.get should be ("2013-01-28 09:00:00")
        event.end_date.get should be ("2013-01-29 17:00:00")
        event.description.get should be ("<P><SPAN STYLE=\"font-family: tahoma, arial, helvetica, sans-serif; color: #003366; font-size: x-large;\">Summary</SPAN></P>\r\n<P><SPAN STYLE=\"font-family: tahoma, arial, helvetica, sans-serif; color: #003366; font-size: medium;\"><A HREF=\"http://www.composables.com\" TARGET=\"_blank\">Composable Solutions</A>, in partnership with <A HREF=\"http://www.typesafe.com\" TARGET=\"_blank\">Typesafe</A>, is pleased to offer a two-day course, designed by Martin Odersky, the creator of the Scala programming language, and Heiko Seeberger, a recognized Scala expert, with a goal of giving you an excellent grounding in Scala.</SPAN></P>\r\n<P><SPAN STYLE=\"font-family: tahoma, arial, helvetica, sans-serif; color: #003366; font-size: medium;\">It is intended to enable developers or development managers, who are experienced programmers in Java or other production languages like C++, C# or Ruby, to confidently start programming in Scala. No previous knowledge of Scala is assumed. Although intense, the course ensures you will have a solid understanding of the fundamentals of the language, the tooling and the development process as well as a good appreciation of the more advanced features. If you already have Scala programming experience, then this course could be a useful refresher.</SPAN></P>\r\n<P><SPAN STYLE=\"font-family: tahoma, arial, helvetica, sans-serif; color: #003366; font-size: medium;\"><BR></SPAN></P>\r\n<P><SPAN STYLE=\"font-family: tahoma, arial, helvetica, sans-serif; color: #003366; font-size: x-large;\">Objectives</SPAN></P>\r\n<P><SPAN STYLE=\"font-family: tahoma, arial, helvetica, sans-serif; color: #003366; font-size: medium;\">After having participated in this course you should:</SPAN></P>\r\n<UL>\r\n<LI><SPAN STYLE=\"font-family: tahoma, arial, helvetica, sans-serif; color: #003366; font-size: medium;\">be a competent user of Scala constructs in application code</SPAN></LI>\r\n<LI><SPAN STYLE=\"font-family: tahoma, arial, helvetica, sans-serif; color: #003366; font-size: medium;\">know and be able to apply the functional programming style in Scala</SPAN></LI>\r\n<LI><SPAN STYLE=\"font-family: tahoma, arial, helvetica, sans-serif; color: #003366; font-size: medium;\">know how to use the fundamental Scala tools</SPAN></LI>\r\n<LI><SPAN STYLE=\"font-family: tahoma, arial, helvetica, sans-serif; color: #003366; font-size: medium;\">be confident to start using Scala in production applications</SPAN></LI>\r\n</UL>\r\n<P><SPAN STYLE=\"line-height: 21px; text-align: -webkit-auto; font-family: tahoma, arial, helvetica, sans-serif; color: #003366; font-size: medium;\"><SPAN STYLE=\"font-size: x-large;\"><BR></SPAN></SPAN></P>\r\n<P><SPAN STYLE=\"line-height: 21px; text-align: -webkit-auto; font-family: tahoma, arial, helvetica, sans-serif; color: #003366; font-size: medium;\"><SPAN STYLE=\"font-size: x-large;\">Prerequisites</SPAN>\u00a0</SPAN></P>\r\n<P><SPAN STYLE=\"line-height: 21px; text-align: -webkit-auto; font-family: tahoma, arial, helvetica, sans-serif; color: #003366; font-size: medium;\">The presentation will frequently be mixed with hands-on exercises that give you a good opportunity to try what you have learnt and a chance to clarify your understanding. The training facility can provide a certain number of workstations, but we highly recommend bringing your laptop so that you can preserve a fully set up Scala development environment after the course ends.</SPAN></P>\r\n<P><SPAN STYLE=\"line-height: 21px; text-align: -webkit-auto; font-family: tahoma, arial, helvetica, sans-serif; color: #003366; font-size: medium;\"><BR></SPAN></P>\r\n<P STYLE=\"text-align: -webkit-auto;\"><SPAN STYLE=\"font-size: x-large; color: #003366;\">Instructors</SPAN><SPAN STYLE=\"color: #003366; font-family: tahoma, arial, helvetica, sans-serif; line-height: 21px; font-size: medium;\">\u00a0</SPAN>\u00a0</P>\r\n<P><SPAN STYLE=\"line-height: 21px; text-align: -webkit-auto; font-family: tahoma, arial, helvetica, sans-serif; color: #003366; font-size: medium;\"><SPAN STYLE=\"line-height: 18px;\"><SPAN STYLE=\"font-size: large;\"><STRONG>Brian Clapper</STRONG></SPAN> has nearly 30 years' experience building and maintaining software systems and has been a consultant since 2009. Brian has a broad base of experience, from financial trading systems and master data management software to ecommerce web sites and Internet advertising software. He is comfortable working in companies of all sizes, but he has a special fondness for high-energy startups. He knows, and regularly uses, many different programming languages, including Scala, Python, Ruby, Java, C and C#. (He likes to think of himself as a generalist and a polyglot.) Brian is founder of the\u00a0</SPAN><SPAN STYLE=\"color: #ff6600;\"><A STYLE=\"color: #0088cc; font-family: 'Open Sans', Helvetica, Arial, sans-serif; font-size: 16px; line-height: 18px;\" HREF=\"http://scala-phase.org/\" TARGET=\"_blank\"><SPAN STYLE=\"color: #ff6600;\">Philadelphia Area Scala Enthusiasts</SPAN></A></SPAN><SPAN STYLE=\"line-height: 18px;\">\u00a0(PHASE). He is co-organizer of\u00a0</SPAN><SPAN STYLE=\"color: #ff6600;\"><A STYLE=\"color: #0088cc; font-family: 'Open Sans', Helvetica, Arial, sans-serif; font-size: 16px; line-height: 18px;\" HREF=\"http://scalathon.org/\" TARGET=\"_blank\"><SPAN STYLE=\"color: #ff6600;\">Scalathon</SPAN></A></SPAN><SPAN STYLE=\"line-height: 18px;\">, the international Scala hackathon, and he has been a co-organizer of the annual\u00a0</SPAN><SPAN STYLE=\"color: #ff6600;\"><A STYLE=\"color: #0088cc; font-family: 'Open Sans', Helvetica, Arial, sans-serif; font-size: 16px; line-height: 18px;\" HREF=\"http://nescala.org/\" TARGET=\"_blank\"><SPAN STYLE=\"color: #ff6600;\">Northeast Scala Symposium</SPAN></A></SPAN><SPAN STYLE=\"line-height: 18px;\">\u00a0since it began, in 2011. Brian maintains a number of open-source Scala projects, including\u00a0</SPAN><SPAN STYLE=\"color: #ff6600;\"><A STYLE=\"color: #0088cc; font-family: 'Open Sans', Helvetica, Arial, sans-serif; font-size: 16px; line-height: 18px;\" HREF=\"http://software.clapper.org/argot/\" TARGET=\"_blank\"><SPAN STYLE=\"color: #ff6600;\">Argot</SPAN></A></SPAN><SPAN STYLE=\"line-height: 18px;\">\u00a0(a command line parser),\u00a0</SPAN><SPAN STYLE=\"color: #ff6600;\"><A STYLE=\"color: #0088cc; font-family: 'Open Sans', Helvetica, Arial, sans-serif; font-size: 16px; line-height: 18px;\" HREF=\"http://software.clapper.org/avsl/\" TARGET=\"_blank\"><SPAN STYLE=\"color: #ff6600;\">AVSL</SPAN></A></SPAN><SPAN STYLE=\"line-height: 18px;\">\u00a0(an\u00a0</SPAN><SPAN STYLE=\"color: #ff6600;\"><A STYLE=\"color: #0088cc; font-family: 'Open Sans', Helvetica, Arial, sans-serif; font-size: 16px; line-height: 18px;\" HREF=\"http://www.slf4j.org/\" TARGET=\"_blank\"><SPAN STYLE=\"color: #ff6600;\">SLF4J</SPAN></A></SPAN><SPAN STYLE=\"line-height: 18px;\">-based logging framework),\u00a0</SPAN><SPAN STYLE=\"color: #ff6600;\"><A STYLE=\"color: #0088cc; font-family: 'Open Sans', Helvetica, Arial, sans-serif; font-size: 16px; line-height: 18px;\" HREF=\"http://software.clapper.org/grizzled-scala/\" TARGET=\"_blank\"><SPAN STYLE=\"color: #ff6600;\">Grizzled Scala</SPAN></A></SPAN><SPAN STYLE=\"line-height: 18px;\">\u00a0(a general purpose library),\u00a0</SPAN><SPAN STYLE=\"color: #ff6600;\"><A STYLE=\"color: #0088cc; font-family: 'Open Sans', Helvetica, Arial, sans-serif; font-size: 16px; line-height: 18px;\" HREF=\"http://software.clapper.org/classutil/\" TARGET=\"_blank\"><SPAN STYLE=\"color: #ff6600;\">ClassUtil</SPAN></A></SPAN><SPAN STYLE=\"line-height: 18px;\">\u00a0(a fast class-finder library),\u00a0</SPAN><SPAN STYLE=\"color: #ff6600;\"><A STYLE=\"color: #0088cc; font-family: 'Open Sans', Helvetica, Arial, sans-serif; font-size: 16px; line-height: 18px;\" HREF=\"http://software.clapper.org/sqlshell/\" TARGET=\"_blank\"><SPAN STYLE=\"color: #ff6600;\">SQLShell</SPAN></A></SPAN><SPAN STYLE=\"line-height: 18px;\">\u00a0(a JDBC-based SQL command shell), and several\u00a0</SPAN><A STYLE=\"color: #0088cc; font-family: 'Open Sans', Helvetica, Arial, sans-serif; font-size: 16px; line-height: 18px;\" HREF=\"http://www.scala-sbt.org/\" TARGET=\"_blank\"><SPAN STYLE=\"color: #003366;\">SBT</SPAN></A><SPAN STYLE=\"line-height: 18px;\">\u00a0plugins. All are available at\u00a0</SPAN><SPAN STYLE=\"color: #ff6600;\"><A STYLE=\"color: #0088cc; font-family: 'Open Sans', Helvetica, Arial, sans-serif; font-size: 16px; line-height: 18px;\" HREF=\"http://software.clapper.org/\" TARGET=\"_blank\"><SPAN STYLE=\"color: #ff6600;\">software.<SPAN CLASS=\"il\">clapper</SPAN>.org</SPAN></A></SPAN><SPAN STYLE=\"line-height: 18px;\">\u00a0or in Brian's\u00a0</SPAN><SPAN STYLE=\"color: #ff6600;\"><A STYLE=\"color: #0088cc; font-family: 'Open Sans', Helvetica, Arial, sans-serif; font-size: 16px; line-height: 18px;\" HREF=\"https://github.com/bmc/\" TARGET=\"_blank\"><SPAN STYLE=\"color: #ff6600;\">GitHub repository</SPAN></A></SPAN><SPAN STYLE=\"line-height: 18px;\">.</SPAN></SPAN></P>\r\n<P STYLE=\"text-align: -webkit-auto;\"><FONT SIZE=\"3\" COLOR=\"#003366\" FACE=\"tahoma, arial, helvetica, sans-serif\"><SPAN STYLE=\"line-height: 18px;\"><BR></SPAN></FONT></P>\r\n<P STYLE=\"color: #000000; font-family: Helvetica, Arial, sans-serif; font-size: 12px; line-height: normal; text-align: left;\"><SPAN STYLE=\"line-height: 21px; text-align: -webkit-auto; font-family: tahoma, arial, helvetica, sans-serif; color: #003366; font-size: medium;\"><SPAN STYLE=\"line-height: 18px;\"><SPAN STYLE=\"font-size: large;\"><STRONG>Nermin Serifovic</STRONG></SPAN> has 10 years of experience building enterprise software applications using Java technologies. For the past 5 years he has focused on architecting, designing and developing backend platforms. Nermin has been a Scala enthusiast since 2009 and practitioning it professionally since mid 2011. He has given various talks at JavaOne, <A HREF=\"http://days2011.scala-lang.org/node/138/293\" TARGET=\"_blank\">Scala Days</A> and <A HREF=\"http://vimeo.com/20290504\" TARGET=\"_blank\">Northeast Scala Symposium</A>, as well as at local Scala and Java user groups. Nermin is a founder and co-organizer of\u00a0</SPAN><SPAN STYLE=\"color: #ff6600;\"><A STYLE=\"color: #0088cc; font-family: 'Open Sans', Helvetica, Arial, sans-serif; font-size: 16px; line-height: 18px;\" HREF=\"http://www.meetup.com/boston-scala/\" TARGET=\"_blank\"><SPAN STYLE=\"color: #ff6600;\">Boston Area Scala Enthusiasts</SPAN></A></SPAN><SPAN STYLE=\"line-height: 18px;\">\u00a0user group and co-founder and co-organizer of\u00a0</SPAN><SPAN STYLE=\"color: #ff6600;\"><A STYLE=\"color: #0088cc; font-family: 'Open Sans', Helvetica, Arial, sans-serif; font-size: 16px; line-height: 18px;\" HREF=\"http://nescala.org/\" TARGET=\"_blank\"><SPAN STYLE=\"color: #ff6600;\">Northeast Scala Symposium</SPAN></A></SPAN><SPAN STYLE=\"line-height: 18px;\">. Furthermore, he is a co-creator and co-maintainer of the\u00a0</SPAN><SPAN STYLE=\"color: #ff6600;\"><A STYLE=\"color: #0088cc; font-family: 'Open Sans', Helvetica, Arial, sans-serif; font-size: 16px; line-height: 18px;\" HREF=\"http://www.scalapuzzlers.com/\" TARGET=\"_blank\"><SPAN STYLE=\"color: #ff6600;\">Scala Puzzlers website</SPAN></A></SPAN><SPAN STYLE=\"line-height: 18px;\">. Nermin holds a MEng in Computer Science from Cornell University and his areas of interest include distributed systems along with concurrent, parallel and functional programming.</SPAN></SPAN></P>\r\n<P><SPAN STYLE=\"font-family: tahoma, arial, helvetica, sans-serif; color: #003366; font-size: medium;\">\u00a0</SPAN></P>\r\n<P><SPAN STYLE=\"font-family: tahoma, arial, helvetica, sans-serif; color: #003366; font-size: x-large;\">Outline</SPAN></P>\r\n<P><STRONG><SPAN STYLE=\"font-family: tahoma, arial, helvetica, sans-serif; color: #003366; font-size: medium;\">Introduction</SPAN></STRONG></P>\r\n<P><STRONG><SPAN STYLE=\"font-family: tahoma, arial, helvetica, sans-serif; color: #003366; font-size: medium;\">First steps in Scala</SPAN></STRONG></P>\r\n<P><STRONG><SPAN STYLE=\"font-family: tahoma, arial, helvetica, sans-serif; color: #003366; font-size: medium;\">OO basics</SPAN></STRONG></P>\r\n<P><STRONG><SPAN STYLE=\"font-family: tahoma, arial, helvetica, sans-serif; color: #003366; font-size: medium;\">Testing</SPAN></STRONG></P>\r\n<P><FONT SIZE=\"3\" COLOR=\"#003366\" FACE=\"tahoma, arial, helvetica, sans-serif\"><STRONG>Collections and functional programming</STRONG></FONT></P>\r\n<P><STRONG><SPAN STYLE=\"font-family: tahoma, arial, helvetica, sans-serif; color: #003366; font-size: medium;\">For-expressions and loops</SPAN></STRONG></P>\r\n<P><SPAN STYLE=\"font-family: tahoma, arial, helvetica, sans-serif; color: #003366; font-size: medium;\"><STRONG>Inheritance and traits</STRONG>\u00a0</SPAN></P>\r\n<P><SPAN STYLE=\"font-family: tahoma, arial, helvetica, sans-serif; color: #003366; font-size: medium;\"><STRONG>Pattern Matching</STRONG>\u00a0</SPAN></P>\r\n<P><SPAN STYLE=\"font-family: tahoma, arial, helvetica, sans-serif; color: #003366; font-size: medium;\"><STRONG>Dealing with optional values</STRONG>\u00a0</SPAN></P>\r\n<DIV>\r\n<DIV><SPAN STYLE=\"font-family: tahoma, arial, helvetica, sans-serif; font-size: small;\"><FONT SIZE=\"3\" COLOR=\"#000080\" FACE=\"tahoma, arial, helvetica, sans-serif\"><SPAN STYLE=\"line-height: 20px;\"><BR></SPAN></FONT></SPAN></DIV>\r\n<DIV><SPAN STYLE=\"font-family: tahoma, arial, helvetica, sans-serif; font-size: small; color: #000080;\"><FONT SIZE=\"3\" COLOR=\"#000080\" FACE=\"tahoma, arial, helvetica, sans-serif\"><SPAN STYLE=\"line-height: 20px;\">Cancellation Policy</SPAN></FONT></SPAN></DIV>\r\n<DIV><SPAN STYLE=\"font-family: tahoma, arial, helvetica, sans-serif; font-size: small; color: #000080;\"><FONT SIZE=\"3\" COLOR=\"#000080\" FACE=\"tahoma, arial, helvetica, sans-serif\"><SPAN STYLE=\"line-height: 20px;\"><BR></SPAN></FONT></SPAN></DIV>\r\n<DIV><SPAN STYLE=\"font-family: tahoma, arial, helvetica, sans-serif; font-size: small; color: #000080;\"><FONT SIZE=\"3\" COLOR=\"#000080\" FACE=\"tahoma, arial, helvetica, sans-serif\"><SPAN STYLE=\"line-height: 20px;\">This course is offered contigent upon minimum enrollment requirements. Composable Solutions reserves the right to cancel the course in case of a low enrollment, not later than three weeks before beginning of the course. You will receive a full refund if the course is cancelled.</SPAN></FONT></SPAN></DIV>\r\n<DIV><SPAN STYLE=\"font-family: tahoma, arial, helvetica, sans-serif; font-size: small; color: #000080;\"><FONT SIZE=\"3\" COLOR=\"#000080\" FACE=\"tahoma, arial, helvetica, sans-serif\"><SPAN STYLE=\"line-height: 20px;\"><BR></SPAN></FONT></SPAN></DIV>\r\n<DIV><SPAN STYLE=\"font-family: tahoma, arial, helvetica, sans-serif; font-size: small; color: #000080;\"><FONT SIZE=\"3\" COLOR=\"#000080\" FACE=\"tahoma, arial, helvetica, sans-serif\"><SPAN STYLE=\"line-height: 20px;\">Students who need to cancel the attendance will receive (less any registration servicing fees):</SPAN></FONT></SPAN></DIV>\r\n<DIV>\r\n<UL>\r\n<LI><SPAN STYLE=\"color: #000080;\"><FONT SIZE=\"3\" COLOR=\"#000080\" FACE=\"tahoma, arial, helvetica, sans-serif\"><SPAN STYLE=\"line-height: 20px;\">Full refund with two weeks notice</SPAN></FONT></SPAN></LI>\r\n<LI><SPAN STYLE=\"color: #000080;\"><FONT SIZE=\"3\" COLOR=\"#000080\" FACE=\"tahoma, arial, helvetica, sans-serif\"><SPAN STYLE=\"line-height: 20px;\">80% refund with one week notice</SPAN></FONT></SPAN></LI>\r\n<LI><SPAN STYLE=\"color: #000080;\"><FONT SIZE=\"3\" COLOR=\"#000080\" FACE=\"tahoma, arial, helvetica, sans-serif\"><SPAN STYLE=\"line-height: 20px;\">25% refund with less than one week notice</SPAN></FONT></SPAN></LI>\r\n</UL>\r\n</DIV>\r\n</DIV>")
        event.tags.get should be ("Scala training")
        event.url.get should be ("http://www.eventbrite.com/event/4819205373/SRCH")
        event.timezone_offset.get should be ("GMT-0500")
        event.venue.get.address.get should be ("line 1 of address")
        event.venue.get.address_2.get should be ("line 2 of address")
        event.venue.get.postal_code.get should be ("75000")
        event.venue.get.region.get should be ("MA")
        event.venue.get.country.get should be ("United States")
        event.venue.get.city.get should be ("Boston")
    }

    test("should map event with ignored additionnal field : modified") {
        val json = """{
             "event":{
                 "id":4819205373,
                 "title":"Typesafe's Fast Track to Scala",
                 "start_date":"2013-01-28 09:00:00",
                 "end_date":"2013-01-29 17:00:00",
                 "description":"<P><SPAN STYLE=\"font-family: tahoma, arial, helvetica, sans-serif; color: #003366; font-size: x-large;\">Summary</SPAN></P>\r\n<P><SPAN STYLE=\"font-family: tahoma, arial, helvetica, sans-serif; color: #003366; font-size: medium;\"><A HREF=\"http://www.composables.com\" TARGET=\"_blank\">Composable Solutions</A>, in partnership with <A HREF=\"http://www.typesafe.com\" TARGET=\"_blank\">Typesafe</A>, is pleased to offer a two-day course, designed by Martin Odersky, the creator of the Scala programming language, and Heiko Seeberger, a recognized Scala expert, with a goal of giving you an excellent grounding in Scala.</SPAN></P>\r\n<P><SPAN STYLE=\"font-family: tahoma, arial, helvetica, sans-serif; color: #003366; font-size: medium;\">It is intended to enable developers or development managers, who are experienced programmers in Java or other production languages like C++, C# or Ruby, to confidently start programming in Scala. No previous knowledge of Scala is assumed. Although intense, the course ensures you will have a solid understanding of the fundamentals of the language, the tooling and the development process as well as a good appreciation of the more advanced features. If you already have Scala programming experience, then this course could be a useful refresher.</SPAN></P>\r\n<P><SPAN STYLE=\"font-family: tahoma, arial, helvetica, sans-serif; color: #003366; font-size: medium;\"><BR></SPAN></P>\r\n<P><SPAN STYLE=\"font-family: tahoma, arial, helvetica, sans-serif; color: #003366; font-size: x-large;\">Objectives</SPAN></P>\r\n<P><SPAN STYLE=\"font-family: tahoma, arial, helvetica, sans-serif; color: #003366; font-size: medium;\">After having participated in this course you should:</SPAN></P>\r\n<UL>\r\n<LI><SPAN STYLE=\"font-family: tahoma, arial, helvetica, sans-serif; color: #003366; font-size: medium;\">be a competent user of Scala constructs in application code</SPAN></LI>\r\n<LI><SPAN STYLE=\"font-family: tahoma, arial, helvetica, sans-serif; color: #003366; font-size: medium;\">know and be able to apply the functional programming style in Scala</SPAN></LI>\r\n<LI><SPAN STYLE=\"font-family: tahoma, arial, helvetica, sans-serif; color: #003366; font-size: medium;\">know how to use the fundamental Scala tools</SPAN></LI>\r\n<LI><SPAN STYLE=\"font-family: tahoma, arial, helvetica, sans-serif; color: #003366; font-size: medium;\">be confident to start using Scala in production applications</SPAN></LI>\r\n</UL>\r\n<P><SPAN STYLE=\"line-height: 21px; text-align: -webkit-auto; font-family: tahoma, arial, helvetica, sans-serif; color: #003366; font-size: medium;\"><SPAN STYLE=\"font-size: x-large;\"><BR></SPAN></SPAN></P>\r\n<P><SPAN STYLE=\"line-height: 21px; text-align: -webkit-auto; font-family: tahoma, arial, helvetica, sans-serif; color: #003366; font-size: medium;\"><SPAN STYLE=\"font-size: x-large;\">Prerequisites</SPAN>\u00a0</SPAN></P>\r\n<P><SPAN STYLE=\"line-height: 21px; text-align: -webkit-auto; font-family: tahoma, arial, helvetica, sans-serif; color: #003366; font-size: medium;\">The presentation will frequently be mixed with hands-on exercises that give you a good opportunity to try what you have learnt and a chance to clarify your understanding. The training facility can provide a certain number of workstations, but we highly recommend bringing your laptop so that you can preserve a fully set up Scala development environment after the course ends.</SPAN></P>\r\n<P><SPAN STYLE=\"line-height: 21px; text-align: -webkit-auto; font-family: tahoma, arial, helvetica, sans-serif; color: #003366; font-size: medium;\"><BR></SPAN></P>\r\n<P STYLE=\"text-align: -webkit-auto;\"><SPAN STYLE=\"font-size: x-large; color: #003366;\">Instructors</SPAN><SPAN STYLE=\"color: #003366; font-family: tahoma, arial, helvetica, sans-serif; line-height: 21px; font-size: medium;\">\u00a0</SPAN>\u00a0</P>\r\n<P><SPAN STYLE=\"line-height: 21px; text-align: -webkit-auto; font-family: tahoma, arial, helvetica, sans-serif; color: #003366; font-size: medium;\"><SPAN STYLE=\"line-height: 18px;\"><SPAN STYLE=\"font-size: large;\"><STRONG>Brian Clapper</STRONG></SPAN> has nearly 30 years' experience building and maintaining software systems and has been a consultant since 2009. Brian has a broad base of experience, from financial trading systems and master data management software to ecommerce web sites and Internet advertising software. He is comfortable working in companies of all sizes, but he has a special fondness for high-energy startups. He knows, and regularly uses, many different programming languages, including Scala, Python, Ruby, Java, C and C#. (He likes to think of himself as a generalist and a polyglot.) Brian is founder of the\u00a0</SPAN><SPAN STYLE=\"color: #ff6600;\"><A STYLE=\"color: #0088cc; font-family: 'Open Sans', Helvetica, Arial, sans-serif; font-size: 16px; line-height: 18px;\" HREF=\"http://scala-phase.org/\" TARGET=\"_blank\"><SPAN STYLE=\"color: #ff6600;\">Philadelphia Area Scala Enthusiasts</SPAN></A></SPAN><SPAN STYLE=\"line-height: 18px;\">\u00a0(PHASE). He is co-organizer of\u00a0</SPAN><SPAN STYLE=\"color: #ff6600;\"><A STYLE=\"color: #0088cc; font-family: 'Open Sans', Helvetica, Arial, sans-serif; font-size: 16px; line-height: 18px;\" HREF=\"http://scalathon.org/\" TARGET=\"_blank\"><SPAN STYLE=\"color: #ff6600;\">Scalathon</SPAN></A></SPAN><SPAN STYLE=\"line-height: 18px;\">, the international Scala hackathon, and he has been a co-organizer of the annual\u00a0</SPAN><SPAN STYLE=\"color: #ff6600;\"><A STYLE=\"color: #0088cc; font-family: 'Open Sans', Helvetica, Arial, sans-serif; font-size: 16px; line-height: 18px;\" HREF=\"http://nescala.org/\" TARGET=\"_blank\"><SPAN STYLE=\"color: #ff6600;\">Northeast Scala Symposium</SPAN></A></SPAN><SPAN STYLE=\"line-height: 18px;\">\u00a0since it began, in 2011. Brian maintains a number of open-source Scala projects, including\u00a0</SPAN><SPAN STYLE=\"color: #ff6600;\"><A STYLE=\"color: #0088cc; font-family: 'Open Sans', Helvetica, Arial, sans-serif; font-size: 16px; line-height: 18px;\" HREF=\"http://software.clapper.org/argot/\" TARGET=\"_blank\"><SPAN STYLE=\"color: #ff6600;\">Argot</SPAN></A></SPAN><SPAN STYLE=\"line-height: 18px;\">\u00a0(a command line parser),\u00a0</SPAN><SPAN STYLE=\"color: #ff6600;\"><A STYLE=\"color: #0088cc; font-family: 'Open Sans', Helvetica, Arial, sans-serif; font-size: 16px; line-height: 18px;\" HREF=\"http://software.clapper.org/avsl/\" TARGET=\"_blank\"><SPAN STYLE=\"color: #ff6600;\">AVSL</SPAN></A></SPAN><SPAN STYLE=\"line-height: 18px;\">\u00a0(an\u00a0</SPAN><SPAN STYLE=\"color: #ff6600;\"><A STYLE=\"color: #0088cc; font-family: 'Open Sans', Helvetica, Arial, sans-serif; font-size: 16px; line-height: 18px;\" HREF=\"http://www.slf4j.org/\" TARGET=\"_blank\"><SPAN STYLE=\"color: #ff6600;\">SLF4J</SPAN></A></SPAN><SPAN STYLE=\"line-height: 18px;\">-based logging framework),\u00a0</SPAN><SPAN STYLE=\"color: #ff6600;\"><A STYLE=\"color: #0088cc; font-family: 'Open Sans', Helvetica, Arial, sans-serif; font-size: 16px; line-height: 18px;\" HREF=\"http://software.clapper.org/grizzled-scala/\" TARGET=\"_blank\"><SPAN STYLE=\"color: #ff6600;\">Grizzled Scala</SPAN></A></SPAN><SPAN STYLE=\"line-height: 18px;\">\u00a0(a general purpose library),\u00a0</SPAN><SPAN STYLE=\"color: #ff6600;\"><A STYLE=\"color: #0088cc; font-family: 'Open Sans', Helvetica, Arial, sans-serif; font-size: 16px; line-height: 18px;\" HREF=\"http://software.clapper.org/classutil/\" TARGET=\"_blank\"><SPAN STYLE=\"color: #ff6600;\">ClassUtil</SPAN></A></SPAN><SPAN STYLE=\"line-height: 18px;\">\u00a0(a fast class-finder library),\u00a0</SPAN><SPAN STYLE=\"color: #ff6600;\"><A STYLE=\"color: #0088cc; font-family: 'Open Sans', Helvetica, Arial, sans-serif; font-size: 16px; line-height: 18px;\" HREF=\"http://software.clapper.org/sqlshell/\" TARGET=\"_blank\"><SPAN STYLE=\"color: #ff6600;\">SQLShell</SPAN></A></SPAN><SPAN STYLE=\"line-height: 18px;\">\u00a0(a JDBC-based SQL command shell), and several\u00a0</SPAN><A STYLE=\"color: #0088cc; font-family: 'Open Sans', Helvetica, Arial, sans-serif; font-size: 16px; line-height: 18px;\" HREF=\"http://www.scala-sbt.org/\" TARGET=\"_blank\"><SPAN STYLE=\"color: #003366;\">SBT</SPAN></A><SPAN STYLE=\"line-height: 18px;\">\u00a0plugins. All are available at\u00a0</SPAN><SPAN STYLE=\"color: #ff6600;\"><A STYLE=\"color: #0088cc; font-family: 'Open Sans', Helvetica, Arial, sans-serif; font-size: 16px; line-height: 18px;\" HREF=\"http://software.clapper.org/\" TARGET=\"_blank\"><SPAN STYLE=\"color: #ff6600;\">software.<SPAN CLASS=\"il\">clapper</SPAN>.org</SPAN></A></SPAN><SPAN STYLE=\"line-height: 18px;\">\u00a0or in Brian's\u00a0</SPAN><SPAN STYLE=\"color: #ff6600;\"><A STYLE=\"color: #0088cc; font-family: 'Open Sans', Helvetica, Arial, sans-serif; font-size: 16px; line-height: 18px;\" HREF=\"https://github.com/bmc/\" TARGET=\"_blank\"><SPAN STYLE=\"color: #ff6600;\">GitHub repository</SPAN></A></SPAN><SPAN STYLE=\"line-height: 18px;\">.</SPAN></SPAN></P>\r\n<P STYLE=\"text-align: -webkit-auto;\"><FONT SIZE=\"3\" COLOR=\"#003366\" FACE=\"tahoma, arial, helvetica, sans-serif\"><SPAN STYLE=\"line-height: 18px;\"><BR></SPAN></FONT></P>\r\n<P STYLE=\"color: #000000; font-family: Helvetica, Arial, sans-serif; font-size: 12px; line-height: normal; text-align: left;\"><SPAN STYLE=\"line-height: 21px; text-align: -webkit-auto; font-family: tahoma, arial, helvetica, sans-serif; color: #003366; font-size: medium;\"><SPAN STYLE=\"line-height: 18px;\"><SPAN STYLE=\"font-size: large;\"><STRONG>Nermin Serifovic</STRONG></SPAN> has 10 years of experience building enterprise software applications using Java technologies. For the past 5 years he has focused on architecting, designing and developing backend platforms. Nermin has been a Scala enthusiast since 2009 and practitioning it professionally since mid 2011. He has given various talks at JavaOne, <A HREF=\"http://days2011.scala-lang.org/node/138/293\" TARGET=\"_blank\">Scala Days</A> and <A HREF=\"http://vimeo.com/20290504\" TARGET=\"_blank\">Northeast Scala Symposium</A>, as well as at local Scala and Java user groups. Nermin is a founder and co-organizer of\u00a0</SPAN><SPAN STYLE=\"color: #ff6600;\"><A STYLE=\"color: #0088cc; font-family: 'Open Sans', Helvetica, Arial, sans-serif; font-size: 16px; line-height: 18px;\" HREF=\"http://www.meetup.com/boston-scala/\" TARGET=\"_blank\"><SPAN STYLE=\"color: #ff6600;\">Boston Area Scala Enthusiasts</SPAN></A></SPAN><SPAN STYLE=\"line-height: 18px;\">\u00a0user group and co-founder and co-organizer of\u00a0</SPAN><SPAN STYLE=\"color: #ff6600;\"><A STYLE=\"color: #0088cc; font-family: 'Open Sans', Helvetica, Arial, sans-serif; font-size: 16px; line-height: 18px;\" HREF=\"http://nescala.org/\" TARGET=\"_blank\"><SPAN STYLE=\"color: #ff6600;\">Northeast Scala Symposium</SPAN></A></SPAN><SPAN STYLE=\"line-height: 18px;\">. Furthermore, he is a co-creator and co-maintainer of the\u00a0</SPAN><SPAN STYLE=\"color: #ff6600;\"><A STYLE=\"color: #0088cc; font-family: 'Open Sans', Helvetica, Arial, sans-serif; font-size: 16px; line-height: 18px;\" HREF=\"http://www.scalapuzzlers.com/\" TARGET=\"_blank\"><SPAN STYLE=\"color: #ff6600;\">Scala Puzzlers website</SPAN></A></SPAN><SPAN STYLE=\"line-height: 18px;\">. Nermin holds a MEng in Computer Science from Cornell University and his areas of interest include distributed systems along with concurrent, parallel and functional programming.</SPAN></SPAN></P>\r\n<P><SPAN STYLE=\"font-family: tahoma, arial, helvetica, sans-serif; color: #003366; font-size: medium;\">\u00a0</SPAN></P>\r\n<P><SPAN STYLE=\"font-family: tahoma, arial, helvetica, sans-serif; color: #003366; font-size: x-large;\">Outline</SPAN></P>\r\n<P><STRONG><SPAN STYLE=\"font-family: tahoma, arial, helvetica, sans-serif; color: #003366; font-size: medium;\">Introduction</SPAN></STRONG></P>\r\n<P><STRONG><SPAN STYLE=\"font-family: tahoma, arial, helvetica, sans-serif; color: #003366; font-size: medium;\">First steps in Scala</SPAN></STRONG></P>\r\n<P><STRONG><SPAN STYLE=\"font-family: tahoma, arial, helvetica, sans-serif; color: #003366; font-size: medium;\">OO basics</SPAN></STRONG></P>\r\n<P><STRONG><SPAN STYLE=\"font-family: tahoma, arial, helvetica, sans-serif; color: #003366; font-size: medium;\">Testing</SPAN></STRONG></P>\r\n<P><FONT SIZE=\"3\" COLOR=\"#003366\" FACE=\"tahoma, arial, helvetica, sans-serif\"><STRONG>Collections and functional programming</STRONG></FONT></P>\r\n<P><STRONG><SPAN STYLE=\"font-family: tahoma, arial, helvetica, sans-serif; color: #003366; font-size: medium;\">For-expressions and loops</SPAN></STRONG></P>\r\n<P><SPAN STYLE=\"font-family: tahoma, arial, helvetica, sans-serif; color: #003366; font-size: medium;\"><STRONG>Inheritance and traits</STRONG>\u00a0</SPAN></P>\r\n<P><SPAN STYLE=\"font-family: tahoma, arial, helvetica, sans-serif; color: #003366; font-size: medium;\"><STRONG>Pattern Matching</STRONG>\u00a0</SPAN></P>\r\n<P><SPAN STYLE=\"font-family: tahoma, arial, helvetica, sans-serif; color: #003366; font-size: medium;\"><STRONG>Dealing with optional values</STRONG>\u00a0</SPAN></P>\r\n<DIV>\r\n<DIV><SPAN STYLE=\"font-family: tahoma, arial, helvetica, sans-serif; font-size: small;\"><FONT SIZE=\"3\" COLOR=\"#000080\" FACE=\"tahoma, arial, helvetica, sans-serif\"><SPAN STYLE=\"line-height: 20px;\"><BR></SPAN></FONT></SPAN></DIV>\r\n<DIV><SPAN STYLE=\"font-family: tahoma, arial, helvetica, sans-serif; font-size: small; color: #000080;\"><FONT SIZE=\"3\" COLOR=\"#000080\" FACE=\"tahoma, arial, helvetica, sans-serif\"><SPAN STYLE=\"line-height: 20px;\">Cancellation Policy</SPAN></FONT></SPAN></DIV>\r\n<DIV><SPAN STYLE=\"font-family: tahoma, arial, helvetica, sans-serif; font-size: small; color: #000080;\"><FONT SIZE=\"3\" COLOR=\"#000080\" FACE=\"tahoma, arial, helvetica, sans-serif\"><SPAN STYLE=\"line-height: 20px;\"><BR></SPAN></FONT></SPAN></DIV>\r\n<DIV><SPAN STYLE=\"font-family: tahoma, arial, helvetica, sans-serif; font-size: small; color: #000080;\"><FONT SIZE=\"3\" COLOR=\"#000080\" FACE=\"tahoma, arial, helvetica, sans-serif\"><SPAN STYLE=\"line-height: 20px;\">This course is offered contigent upon minimum enrollment requirements. Composable Solutions reserves the right to cancel the course in case of a low enrollment, not later than three weeks before beginning of the course. You will receive a full refund if the course is cancelled.</SPAN></FONT></SPAN></DIV>\r\n<DIV><SPAN STYLE=\"font-family: tahoma, arial, helvetica, sans-serif; font-size: small; color: #000080;\"><FONT SIZE=\"3\" COLOR=\"#000080\" FACE=\"tahoma, arial, helvetica, sans-serif\"><SPAN STYLE=\"line-height: 20px;\"><BR></SPAN></FONT></SPAN></DIV>\r\n<DIV><SPAN STYLE=\"font-family: tahoma, arial, helvetica, sans-serif; font-size: small; color: #000080;\"><FONT SIZE=\"3\" COLOR=\"#000080\" FACE=\"tahoma, arial, helvetica, sans-serif\"><SPAN STYLE=\"line-height: 20px;\">Students who need to cancel the attendance will receive (less any registration servicing fees):</SPAN></FONT></SPAN></DIV>\r\n<DIV>\r\n<UL>\r\n<LI><SPAN STYLE=\"color: #000080;\"><FONT SIZE=\"3\" COLOR=\"#000080\" FACE=\"tahoma, arial, helvetica, sans-serif\"><SPAN STYLE=\"line-height: 20px;\">Full refund with two weeks notice</SPAN></FONT></SPAN></LI>\r\n<LI><SPAN STYLE=\"color: #000080;\"><FONT SIZE=\"3\" COLOR=\"#000080\" FACE=\"tahoma, arial, helvetica, sans-serif\"><SPAN STYLE=\"line-height: 20px;\">80% refund with one week notice</SPAN></FONT></SPAN></LI>\r\n<LI><SPAN STYLE=\"color: #000080;\"><FONT SIZE=\"3\" COLOR=\"#000080\" FACE=\"tahoma, arial, helvetica, sans-serif\"><SPAN STYLE=\"line-height: 20px;\">25% refund with less than one week notice</SPAN></FONT></SPAN></LI>\r\n</UL>\r\n</DIV>\r\n</DIV>",
                 "tags":"Scala training",
                 "url":"http://www.eventbrite.com/event/4819205373/SRCH",
                 "modified":"2012-11-11 18:43:13",
                 "timezone_offset":"GMT-0500"
             }
        }"""
        val event: Event = parse[EventOrSummary](json).event.get
        event.id.get should be ("4819205373")
    }

    test("should map event with missing fields") {
        val json = """{
             "event":{
                "modified":"2012-11-11 18:43:13"
             }
        }"""
        val event: Event = parse[EventOrSummary](json).event.get
        event.id should be (None)
        event.title should be (None)
        event.start_date should be (None)
        event.end_date should be (None)
        event.description should be (None)
        event.tags should be (None)
        event.url should be (None)
        event.timezone_offset should be (None)
    }

    test("should parse real eventbrite stream without exception") {
        val events: Seq[Event] = Eventbrite.parse(Eventbrite.request("scala"))
    }

    test("should throw exception when stream is invalid") {
        evaluating {
            Eventbrite.parse("""{toto}}}""")
        } should produce [com.codahale.jerkson.ParsingException]
    }

    test("request with country filter should not throw exception") {
        val events = Eventbrite.parse(Eventbrite.request("java", Some("FR")))
    }

    test("should understand no event found") {
        val response = Eventbrite.parse("""{"events": [], "error": {"error_type": "Not Found", "error_message": "No events found matching the following criteria. [organizer=pppppppppppppp,  ]"}}""")
        response should be (Nil)
    }

    test("request with bad license key should throw IllegalArgumentException") {
        val thrown = evaluating {
            Eventbrite.parse(Eventbrite.request(keyWork = "toto", licenseKey = "invalidLicenceKey"))
        } should produce [IllegalArgumentException]
        thrown.getMessage should (include("application key") and include ("not valid"))
    }

    test("unknown response from eventbrite should throw IllegalStateException") {
        val thrown = evaluating {
            Eventbrite.parse("""{"toto": "titi"}""")
        } should produce [IllegalStateException]
        thrown.getMessage should include ("""{"toto": "titi"}""")
    }
}

object Eventbrite extends Json {
    type JsonResponse = String

    /** @param countryCode @see http://www.iso.org/iso/country_codes/iso_3166_code_lists/country_names_and_code_elements **/
    def request(keyWork: String, countryCode: Option[String] = None, licenseKey: String = "2Z5MEY5C4CD7D3FXUA"): JsonResponse = {
        val countryParam: String = countryCode match {
            case Some(code) => "&country=" + code
            case _ => ""
        }
        val url = "https://www.eventbrite.com/json/event_search" +
            "?app_key=" + licenseKey +
            "&keywords=" + keyWork +
            countryParam
        new BufferedReader(new InputStreamReader( new URL(url).openStream() )).readLine()
    }

    def parse(json: JsonResponse): Seq[Event] = {
        parse[EventbriteResponse](json) match {
            case EventbriteResponse(None, Some(eventbriteError)) =>
                throw new IllegalArgumentException(eventbriteError.error_type.get + " : " + eventbriteError.error_message.get)
            case EventbriteResponse(Some(events), _) => {
                events
                    .filter(_.event.isDefined)
                    .map(_.event.get)
            }
            case unknownResponse => throw new IllegalStateException("unknown response from eventbrite : " + json)
        }
    }
}

@JsonIgnoreProperties(ignoreUnknown = true)
case class EventbriteResponse(events: Option[Seq[EventOrSummary]], error: Option[EventBriteError])

@JsonIgnoreProperties(ignoreUnknown = true)
case class EventOrSummary(event: Option[Event], summary: Option[Any])

@JsonIgnoreProperties(ignoreUnknown = true)
case class Event(id: Option[String],
                           title: Option[String],
                           start_date: Option[String],
                           description: Option[String],
                           end_date: Option[String],
                           tags: Option[String],
                           timezone_offset: Option[String],
                           url: Option[String],
                           venue: Option[Venue])

@JsonIgnoreProperties(ignoreUnknown = true)
case class Venue(address: Option[String],
                 address_2: Option[String],
                 city: Option[String],
                 region: Option[String],
                 country: Option[String],
                 postal_code: Option[String])

@JsonIgnoreProperties(ignoreUnknown = true)
case class EventBriteError(error_type: Option[String], error_message: Option[String])
